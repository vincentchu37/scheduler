<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="gitlab-dast-validation" content="059797f5-753a-48b7-80a6-3de722cda1a5">
    <title>Event Scheduler</title>
    <meta name="description" content="Simple event scheduler for multiple people.">
	<meta name="author" content="https://gitlab.com/vincentchu">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/css/bootstrap.min.css" integrity="sha512-jnSuA4Ss2PkkikSOLtYs8BlYIeeIK1h99ty4YfvRPAlzr377vr3CXDb7sb7eEEBYjDtcYj+AjBH3FLv5uSJuXg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.14.1/themes/base/theme.min.css" integrity="sha512-lfR3NT1DltR5o7HyoeYWngQbo6Ec4ITaZuIw6oAxIiCNYu22U5kpwHy9wAaN0vvBj3U6Uy2NNtAfiaKcDxfhTg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet" href="style.css">
</head>

<body>
    <div class="container my-4">
        <h2 class="text-center mb-4">Create Event</h2>

        <!-- Event Information Form -->
        <div class="row mb-4">
            <div class="card">
                <div class="card-body">
                    <form id="event-form" method="post">
                        <div class="row mb-3">
                            <div class="col-md">
                                <label for="event-name" class="form-label">Event Name</label>
                                <input type="text" class="form-control" name="event-name" required>
                            </div>
                            <div class="col-md mb-3">
                                <label for="timezone" class="form-label">Timezone</label>
                                <select id="timezone" class="form-select">
                                    <option value="Pacific/Midway">(GMT-11:00) Midway Island</option>
                                    <option value="America/Adak">(GMT-10:00) Hawaii-Aleutian</option>
                                    <option value="Etc/GMT+10">(GMT-10:00) Hawaii</option>
                                    <option value="Pacific/Marquesas">(GMT-09:30) Marquesas Islands</option>
                                    <option value="Pacific/Gambier">(GMT-09:00) Gambier Islands</option>
                                    <option value="America/Anchorage">(GMT-09:00) Alaska</option>
                                    <option value="America/Ensenada">(GMT-08:00) Tijuana, Baja California</option>
                                    <option value="Etc/GMT+8">(GMT-08:00) Pitcairn Islands</option>
                                    <option value="America/Los_Angeles">(GMT-08:00) Pacific Time (US & Canada)</option>
                                    <option value="America/Denver">(GMT-07:00) Mountain Time (US & Canada)</option>
                                    <option value="America/Chihuahua">(GMT-07:00) Chihuahua, La Paz, Mazatlan</option>
                                    <option value="America/Dawson_Creek">(GMT-07:00) Arizona</option>
                                    <option value="America/Belize">(GMT-06:00) Saskatchewan, Central America</option>
                                    <option value="America/Cancun">(GMT-06:00) Guadalajara, Mexico City, Monterrey</option>
                                    <option value="Chile/EasterIsland">(GMT-06:00) Easter Island</option>
                                    <option value="America/Chicago">(GMT-06:00) Central Time (US & Canada)</option>
                                    <option value="America/New_York">(GMT-05:00) Eastern Time (US & Canada)</option>
                                    <option value="America/Havana">(GMT-05:00) Cuba</option>
                                    <option value="America/Bogota">(GMT-05:00) Bogota, Lima, Quito, Rio Branco</option>
                                    <option value="America/Caracas">(GMT-04:30) Caracas</option>
                                    <option value="America/Santiago">(GMT-04:00) Santiago</option>
                                    <option value="America/La_Paz">(GMT-04:00) La Paz</option>
                                    <option value="Atlantic/Stanley">(GMT-04:00) Faukland Islands</option>
                                    <option value="America/Campo_Grande">(GMT-04:00) Brazil</option>
                                    <option value="America/Goose_Bay">(GMT-04:00) Atlantic Time (Goose Bay)</option>
                                    <option value="America/Glace_Bay">(GMT-04:00) Atlantic Time (Canada)</option>
                                    <option value="America/St_Johns">(GMT-03:30) Newfoundland</option>
                                    <option value="America/Araguaina">(GMT-03:00) UTC-3</option>
                                    <option value="America/Montevideo">(GMT-03:00) Montevideo</option>
                                    <option value="America/Miquelon">(GMT-03:00) Miquelon, St. Pierre</option>
                                    <option value="America/Godthab">(GMT-03:00) Greenland</option>
                                    <option value="America/Argentina/Buenos_Aires">(GMT-03:00) Buenos Aires</option>
                                    <option value="America/Sao_Paulo">(GMT-03:00) Brasilia</option>
                                    <option value="America/Noronha">(GMT-02:00) Mid-Atlantic</option>
                                    <option value="Atlantic/Cape_Verde">(GMT-01:00) Cape Verde Is.</option>
                                    <option value="Atlantic/Azores">(GMT-01:00) Azores</option>
                                    <option value="Europe/Belfast">(GMT) Greenwich Mean Time : Belfast</option>
                                    <option value="Europe/Dublin">(GMT) Greenwich Mean Time : Dublin</option>
                                    <option value="Europe/Lisbon">(GMT) Greenwich Mean Time : Lisbon</option>
                                    <option value="Europe/London">(GMT) Greenwich Mean Time : London</option>
                                    <option value="Africa/Abidjan">(GMT) Monrovia, Reykjavik</option>
                                    <option value="Europe/Amsterdam">(GMT+01:00) Amsterdam, Berlin, Bern, Rome, Stockholm, Vienna</option>
                                    <option value="Europe/Belgrade">(GMT+01:00) Belgrade, Bratislava, Budapest, Ljubljana, Prague</option>
                                    <option value="Europe/Brussels">(GMT+01:00) Brussels, Copenhagen, Madrid, Paris</option>
                                    <option value="Africa/Algiers">(GMT+01:00) West Central Africa</option>
                                    <option value="Africa/Windhoek">(GMT+01:00) Windhoek</option>
                                    <option value="Asia/Beirut">(GMT+02:00) Beirut</option>
                                    <option value="Africa/Cairo">(GMT+02:00) Cairo</option>
                                    <option value="Asia/Gaza">(GMT+02:00) Gaza</option>
                                    <option value="Africa/Blantyre">(GMT+02:00) Harare, Pretoria</option>
                                    <option value="Asia/Jerusalem">(GMT+02:00) Jerusalem</option>
                                    <option value="Europe/Minsk">(GMT+02:00) Minsk</option>
                                    <option value="Asia/Damascus">(GMT+02:00) Syria</option>
                                    <option value="Europe/Moscow">(GMT+03:00) Moscow, St. Petersburg, Volgograd</option>
                                    <option value="Africa/Addis_Ababa">(GMT+03:00) Nairobi</option>
                                    <option value="Asia/Tehran">(GMT+03:30) Tehran</option>
                                    <option value="Asia/Dubai">(GMT+04:00) Abu Dhabi, Muscat</option>
                                    <option value="Asia/Yerevan">(GMT+04:00) Yerevan</option>
                                    <option value="Asia/Kabul">(GMT+04:30) Kabul</option>
                                    <option value="Asia/Yekaterinburg">(GMT+05:00) Ekaterinburg</option>
                                    <option value="Asia/Tashkent">(GMT+05:00) Tashkent</option>
                                    <option value="Asia/Kolkata">(GMT+05:30) Chennai, Kolkata, Mumbai, New Delhi</option>
                                    <option value="Asia/Katmandu">(GMT+05:45) Kathmandu</option>
                                    <option value="Asia/Dhaka">(GMT+06:00) Astana, Dhaka</option>
                                    <option value="Asia/Novosibirsk">(GMT+06:00) Novosibirsk</option>
                                    <option value="Asia/Rangoon">(GMT+06:30) Yangon (Rangoon)</option>
                                    <option value="Asia/Bangkok">(GMT+07:00) Bangkok, Hanoi, Jakarta</option>
                                    <option value="Asia/Krasnoyarsk">(GMT+07:00) Krasnoyarsk</option>
                                    <option value="Asia/Hong_Kong">(GMT+08:00) Beijing, Chongqing, Hong Kong, Urumqi</option>
                                    <option value="Asia/Irkutsk">(GMT+08:00) Irkutsk, Ulaan Bataar</option>
                                    <option value="Australia/Perth">(GMT+08:00) Perth</option>
                                    <option value="Australia/Eucla">(GMT+08:45) Eucla</option>
                                    <option value="Asia/Tokyo">(GMT+09:00) Osaka, Sapporo, Tokyo</option>
                                    <option value="Asia/Seoul">(GMT+09:00) Seoul</option>
                                    <option value="Asia/Yakutsk">(GMT+09:00) Yakutsk</option>
                                    <option value="Australia/Adelaide">(GMT+09:30) Adelaide</option>
                                    <option value="Australia/Darwin">(GMT+09:30) Darwin</option>
                                    <option value="Australia/Brisbane">(GMT+10:00) Brisbane</option>
                                    <option value="Australia/Hobart">(GMT+10:00) Hobart</option>
                                    <option value="Asia/Vladivostok">(GMT+10:00) Vladivostok</option>
                                    <option value="Australia/Lord_Howe">(GMT+10:30) Lord Howe Island</option>
                                    <option value="Etc/GMT-11">(GMT+11:00) Solomon Is., New Caledonia</option>
                                    <option value="Asia/Magadan">(GMT+11:00) Magadan</option>
                                    <option value="Pacific/Norfolk">(GMT+11:30) Norfolk Island</option>
                                    <option value="Asia/Anadyr">(GMT+12:00) Anadyr, Kamchatka</option>
                                    <option value="Pacific/Auckland">(GMT+12:00) Auckland, Wellington</option>
                                    <option value="Etc/GMT-12">(GMT+12:00) Fiji, Kamchatka, Marshall Is.</option>
                                    <option value="Pacific/Chatham">(GMT+12:45) Chatham Islands</option>
                                    <option value="Pacific/Tongatapu">(GMT+13:00) Nuku'alofa</option>
                                    <option value="Pacific/Kiritimati">(GMT+14:00) Kiritimati</option>
                                </select>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-md mb-3">
                                <label for="start-date" class="form-label">Start Date</label>
                                <input type="date" class="form-control" id="start-date" required>
                            </div>
                            <div class="col-md mb-3">
                                <label for="end-date" class="form-label">End Date</label>
                                <input type="date" class="form-control" id="end-date" required>
                            </div>
                            <div class="col-md mb-3">
                                <label for="start-time" class="form-label">Start Time (24hr Time)</label>
                                <input type="text" class="form-control" id="start-time" maxlength="2" required>
                            </div>
                            <div class="col-md mb-3">
                                <label for="end-time" class="form-label">End Time (24hr Time)</label>
                                <input type="text" class="form-control" id="end-time" maxlength="2" required>
                            </div>
                        </div>
                        <input type="hidden" name="uniqueid" id="uniqueid">
                        <input type="hidden" name="start-datetime-utc" id="start-datetime-utc">
                        <input type="hidden" name="end-datetime-utc" id="end-datetime-utc">
                        <div id="date-error" class="alert alert-danger mt-2" style="display: none;">
                            Start <b>date</b> must be before end date.
                        </div>
                        <div id="time-error" class="alert alert-danger mt-2" style="display: none;">
                            Start <b>time</b> cannot be the same as end time.
                        </div>
                        <button type="submit" id="submit" class="btn btn-primary float-end">Create Event</button>
                    </form>
                </div>
            </div>
        </div>
    </div>
    <div class="text-center">
        <strong>Data is only stored for 90 days!!</strong>
    </div>
    <div class="modal fade" id="noevent" tabindex="-1" role="dialog" aria-labelledby="noevent" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Error:</strong> No such event.
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        </div>
    </div>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.3/js/bootstrap.bundle.min.js" integrity="sha512-7Pi/otdlbbCR+LnW+F7PwFcSDJOuUJB3OxtEHbg4vSMvzvJjde4Po1v4BR9Gdc9aXNUNFVUY+SK51wWT8WF0Gg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        function hashModal(modalName) {
            var modalName = new bootstrap.Modal(document.getElementById(modalName), {
                //keyboard: false
            })
            modalName.show()
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/luxon/3.5.0/luxon.min.js" integrity="sha512-SN7iwxiJt9nFKiLayg3NjLItXPwRfBr4SQSIugMeBFrD4lIFJe1Z/exkTZYAg3Ul+AfZEGws2PQ+xSoaWfxRQQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            if (location.hash === "#noevent") {
                hashModal("noevent")
            }
            const uniqueId = generateUniqueId();
            document.getElementById('uniqueid').value = uniqueId;

            // Get form element and update action
            const eventForm = document.getElementById('event-form');
            eventForm.action = "event.php?id=" + uniqueId;
            //auto timezone 
            const userTimeZone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const select = document.getElementById('timezone');
            if (select && userTimeZone) {
                select.value = userTimeZone;
            }

            // 1. Conversion function
            function updateUTCFields() {
                const startDate = document.getElementById('start-date').value;
                const endDate = document.getElementById('end-date').value;
                const startTime = document.getElementById('start-time').value;
                const endTime = document.getElementById('end-time').value;
                const timezone = document.getElementById('timezone').value;

                const padTime = t => t.length === 1 ? `0${t}:00` : (t.includes(':') ? t : `${t}:00`);
                const startDateTimeLocal = `${startDate}T${padTime(startTime)}`;
                const endDateTimeLocal = `${endDate}T${padTime(endTime)}`;

                const { DateTime } = luxon;
                let startUTC = '';
                let endUTC = '';
                if (startDate && startTime && timezone) {
                    startUTC = DateTime.fromISO(startDateTimeLocal, { zone: timezone }).toUTC().toMillis();
                }
                if (endDate && endTime && timezone) {
                    endUTC = DateTime.fromISO(endDateTimeLocal, { zone: timezone }).toUTC().toMillis();
                }

                document.getElementById('start-datetime-utc').value = startUTC;
                document.getElementById('end-datetime-utc').value = endUTC;
            }
            function checkDate(show) {
                const dateError = document.getElementById('date-error');
                const timeError = document.getElementById('time-error');
                const submitBtn = document.getElementById('submit');
                const startDateUtc = parseInt(document.getElementById('start-datetime-utc').value, 10);
                const endDateUtc = parseInt(document.getElementById('end-datetime-utc').value, 10);
                const startTime = parseInt(document.getElementById('start-time').value, 10);
                const endTime = parseInt(document.getElementById('end-time').value, 10);
                if (startDateUtc >= endDateUtc) {
                    dateError.style.display = 'block';
                    submitBtn.disabled = true;
                } else {
                    dateError.style.display = 'none';
                    submitBtn.disabled = false;
                }
                if (startTime = endTime) {
                    timeError.style.display = 'block';
                    submitBtn.disabled = true;
                } else {
                    timeError.style.display = 'none';
                    submitBtn.disabled = false;
                }
                if (endTime > '23') {
                    timeError.style.display = 'block';
                    submitBtn.disabled = true;
                }

            }
            //Call on any relevant field change
            function handleInput() {
                updateUTCFields();
                checkDate();
            }
            window.addEventListener('DOMContentLoaded', handleInput);
            ['start-date', 'end-date', 'start-time', 'end-time', 'timezone'].forEach(id => {
                document.getElementById(id).addEventListener('input', handleInput);
            });
        });


        function generateUniqueId() {
            // Generate 8-character random ID
            const uniqueId = createRandomString(8);

            // Get current date
            const date = new Date();
            const month = String(date.getMonth() + 1).padStart(2, "0"); // Add 1 as months are zero-based
            const year = date.getFullYear();

            // Combine ID with month and year
            return `${uniqueId}-${month}-${year}`;
        }

        // Function to generate random string
        function createRandomString(length) {
            const chars = "ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789";
            let result = "";
            for (let i = 0; i < length; i++) {
                result += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return result;
        }

    </script>
    <!-- Cloudflare Web Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "8dd677a97b1d45aaab4f33a4b78eb87d"}'></script><!-- End Cloudflare Web Analytics -->
</body>

</html>